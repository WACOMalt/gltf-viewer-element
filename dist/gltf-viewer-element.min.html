<template><style>#viewer{display:inline-block}</style><div id="viewer"></div></template><script>!function(a,b){"use strict";function c(a,b){for(var c in b)a[c]=b[c];return a}var d,e=document._currentScript.ownerDocument,f=Object.create(HTMLElement.prototype),g={controls:"TrackballControls",scale:"0.002",width:"320px",height:"240px"};f.createdCallback=function(){var b=e.querySelector("template:first-child"),f=e.importNode(b.content,!0);this.root=this.createShadowRoot().appendChild(f);var h={};for(var i in this.attributes)this.attributes[i].nodeName&&(h[this.attributes[i].nodeName]=this.attributes[i].value);d=c(g,h),this.loadFile(d.src),a.onload=this.initialize.bind(this)},f.initialize=function(){h.webgl?this.renderer=new THREE.WebGLRenderer({antialias:!0}):(h.addGetWebGLMessage(),this.renderer=new THREE.CanvasRenderer);var a=this.shadowRoot.querySelector("#viewer");a.style.width=d.width,a.style.height=d.height,this.scene=new THREE.Scene,this.camera=new THREE.PerspectiveCamera(60,a.clientWidth/a.clientHeight,.1,1e3),this.camera.position.set(4,4,3),this.controls={};var b=new THREE.AmbientLight(328965);this.scene.add(b);var c=new THREE.DirectionalLight(16777215,2);c.position.set(2,1.2,10).normalize(),this.scene.add(c),c=new THREE.DirectionalLight(16777215,1),c.position.set(-2,1.2,-10).normalize(),this.scene.add(c);var e=new THREE.PointLight(16755200,2);e.position.set(2e3,1200,1e4),this.scene.add(e);for(var f=14,g=1,i=new THREE.Geometry,j=new THREE.LineBasicMaterial({color:13421772,opacity:.2}),k=-f;f>=k;k+=g)i.vertices.push(new THREE.Vector3(-f,-.04,k)),i.vertices.push(new THREE.Vector3(f,-.04,k)),i.vertices.push(new THREE.Vector3(k,-.04,-f)),i.vertices.push(new THREE.Vector3(k,-.04,f));var l=new THREE.Line(i,j,THREE.LinePieces);this.scene.add(l),this.renderer.setSize(a.clientWidth,a.clientHeight),this.renderer.setClearColor(16777215),this.controls.trackball=new THREE.TrackballControls(this.camera,a),this.controls.trackball.staticMoving=!0,a.appendChild(this.renderer.domElement),this.animate()},f.attributeChangedCallback=function(a,b,c){switch(a){case"src":this.loadFile(c);break;case"width":this.resize(a,c);break;case"height":this.resize(a,c);break;case"scale":}},f.animate=function(){a.requestAnimationFrame(this.animate.bind(this)),this.render()},f.render=function(){this.controls.trackball.update(),this.renderer.render(this.scene,this.camera)},f.loadFile=function(a){var b=new THREE.glTFLoader;b.load(a,function(a){var b=a.scene;b.scale.x=b.scale.y=b.scale.z=.002,b.updateMatrix(),this.currentModel&&(this.scene.remove(this.currentModel),this.currentModel=null),this.currentModel=b,this.scene.add(b),this.updateLoadReady(a)}.bind(this),this.updateLoadProgress.bind(this))},f.updateLoadProgress=function(a){var b=new CustomEvent("progress-state-change",a);this.dispatchEvent(b)},f.updateLoadReady=function(a){var b=new CustomEvent("progress-state-ready",a);this.dispatchEvent(b)},f.resize=function(a,b){var c=this.shadowRoot.querySelector("#viewer");c.style[a]=b,this.camera.aspect=c.clientWidth/c.clientHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(c.clientWidth,c.clientHeight),this.controls.trackball.handleResize()},document.registerElement("gltf-viewer",{prototype:f});var h={canvas:!!a.CanvasRenderingContext2D,webgl:function(){try{var b=document.createElement("canvas");return!(!a.WebGLRenderingContext||!b.getContext("webgl")&&!b.getContext("experimental-webgl"))}catch(c){return!1}}(),workers:!!a.Worker,fileapi:a.File&&a.FileReader&&a.FileList&&a.Blob,getWebGLErrorMessage:function(){var b=document.createElement("div");return b.id="webgl-error-message",b.style.fontFamily="monospace",b.style.fontSize="13px",b.style.fontWeight="normal",b.style.textAlign="center",b.style.background="#fff",b.style.color="#000",b.style.padding="1.5em",b.style.width="400px",b.style.margin="5em auto 0",this.webgl||(b.innerHTML=a.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n")),b},addGetWebGLMessage:function(a){var c,d,e;a=a||{},c=a.parent!==b?a.parent:document.body,d=a.id!==b?a.id:"oldie",e=h.getWebGLErrorMessage(),e.id=d,c.appendChild(e)}};"object"==typeof module&&(module.exports=h),THREE.TrackballControls=function(c,d){function e(b){n.enabled!==!1&&(a.removeEventListener("keydown",e),s=r,r===o.NONE&&(b.keyCode!==n.keys[o.ROTATE]||n.noRotate?b.keyCode!==n.keys[o.ZOOM]||n.noZoom?b.keyCode!==n.keys[o.PAN]||n.noPan||(r=o.PAN):r=o.ZOOM:r=o.ROTATE))}function f(){n.enabled!==!1&&(r=s,a.addEventListener("keydown",e,!1))}function g(a){n.enabled!==!1&&(a.preventDefault(),a.stopPropagation(),r===o.NONE&&(r=a.button),r!==o.ROTATE||n.noRotate?r!==o.ZOOM||n.noZoom?r!==o.PAN||n.noPan||(A.copy(F(a.pageX,a.pageY)),B.copy(A)):(w.copy(F(a.pageX,a.pageY)),x.copy(w)):(u.copy(G(a.pageX,a.pageY)),v.copy(u)),document.addEventListener("mousemove",h,!1),document.addEventListener("mouseup",i,!1),n.dispatchEvent(D))}function h(a){n.enabled!==!1&&(a.preventDefault(),a.stopPropagation(),r!==o.ROTATE||n.noRotate?r!==o.ZOOM||n.noZoom?r!==o.PAN||n.noPan||B.copy(F(a.pageX,a.pageY)):x.copy(F(a.pageX,a.pageY)):v.copy(G(a.pageX,a.pageY)))}function i(a){n.enabled!==!1&&(a.preventDefault(),a.stopPropagation(),r=o.NONE,document.removeEventListener("mousemove",h),document.removeEventListener("mouseup",i),n.dispatchEvent(E))}function j(a){if(n.enabled!==!1){a.preventDefault(),a.stopPropagation();var b=0;a.wheelDelta?b=a.wheelDelta/40:a.detail&&(b=-a.detail/3),w.y+=.01*b,n.dispatchEvent(D),n.dispatchEvent(E)}}function k(a){if(n.enabled!==!1){switch(a.touches.length){case 1:r=o.TOUCH_ROTATE,u.copy(G(a.touches[0].pageX,a.touches[0].pageY)),v.copy(u);break;case 2:r=o.TOUCH_ZOOM_PAN;var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY;z=y=Math.sqrt(b*b+c*c);var d=(a.touches[0].pageX+a.touches[1].pageX)/2,e=(a.touches[0].pageY+a.touches[1].pageY)/2;A.copy(F(d,e)),B.copy(A);break;default:r=o.NONE}n.dispatchEvent(D)}}function l(a){if(n.enabled!==!1)switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:v.copy(G(a.touches[0].pageX,a.touches[0].pageY));break;case 2:var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY;z=Math.sqrt(b*b+c*c);var d=(a.touches[0].pageX+a.touches[1].pageX)/2,e=(a.touches[0].pageY+a.touches[1].pageY)/2;B.copy(F(d,e));break;default:r=o.NONE}}function m(a){if(n.enabled!==!1){switch(a.touches.length){case 1:v.copy(G(a.touches[0].pageX,a.touches[0].pageY)),u.copy(v);break;case 2:y=z=0;var b=(a.touches[0].pageX+a.touches[1].pageX)/2,c=(a.touches[0].pageY+a.touches[1].pageY)/2;B.copy(F(b,c)),A.copy(B)}r=o.NONE,n.dispatchEvent(E)}}var n=this,o={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=c,this.domElement=d!==b?d:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.noRoll=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new THREE.Vector3;var p=1e-6,q=new THREE.Vector3,r=o.NONE,s=o.NONE,t=new THREE.Vector3,u=new THREE.Vector3,v=new THREE.Vector3,w=new THREE.Vector2,x=new THREE.Vector2,y=0,z=0,A=new THREE.Vector2,B=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var C={type:"change"},D={type:"start"},E={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=a.innerWidth,this.screen.height=a.innerHeight;else{var b=this.domElement.getBoundingClientRect(),c=this.domElement.ownerDocument.documentElement;this.screen.left=b.left+a.pageXOffset-c.clientLeft,this.screen.top=b.top+a.pageYOffset-c.clientTop,this.screen.width=b.width,this.screen.height=b.height}},this.handleEvent=function(a){"function"==typeof this[a.type]&&this[a.type](a)};var F=function(){var a=new THREE.Vector2;return function(b,c){return a.set((b-n.screen.left)/n.screen.width,(c-n.screen.top)/n.screen.height),a}}(),G=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Vector3;return function(d,e){c.set((d-.5*n.screen.width-n.screen.left)/(.5*n.screen.width),(.5*n.screen.height+n.screen.top-e)/(.5*n.screen.height),0);var f=c.length();return n.noRoll?c.z=f<Math.SQRT1_2?Math.sqrt(1-f*f):.5/f:f>1?c.normalize():c.z=Math.sqrt(1-f*f),t.copy(n.object.position).sub(n.target),a.copy(n.object.up).setLength(c.y),a.add(b.copy(n.object.up).cross(t).setLength(c.x)),a.add(t.setLength(c.z)),a}}();this.rotateCamera=function(){var a=new THREE.Vector3,b=new THREE.Quaternion;return function(){var c=Math.acos(u.dot(v)/u.length()/v.length());c&&(a.crossVectors(u,v).normalize(),c*=n.rotateSpeed,b.setFromAxisAngle(a,-c),t.applyQuaternion(b),n.object.up.applyQuaternion(b),v.applyQuaternion(b),n.staticMoving?u.copy(v):(b.setFromAxisAngle(a,c*(n.dynamicDampingFactor-1)),u.applyQuaternion(b)))}}(),this.zoomCamera=function(){if(r===o.TOUCH_ZOOM_PAN){var a=y/z;y=z,t.multiplyScalar(a)}else{var a=1+(x.y-w.y)*n.zoomSpeed;1!==a&&a>0&&(t.multiplyScalar(a),n.staticMoving?w.copy(x):w.y+=(x.y-w.y)*this.dynamicDampingFactor)}},this.panCamera=function(){var a=new THREE.Vector2,b=new THREE.Vector3,c=new THREE.Vector3;return function(){a.copy(B).sub(A),a.lengthSq()&&(a.multiplyScalar(t.length()*n.panSpeed),c.copy(t).cross(n.object.up).setLength(a.x),c.add(b.copy(n.object.up).setLength(a.y)),n.object.position.add(c),n.target.add(c),n.staticMoving?A.copy(B):A.add(a.subVectors(B,A).multiplyScalar(n.dynamicDampingFactor)))}}(),this.checkDistances=function(){n.noZoom&&n.noPan||(t.lengthSq()>n.maxDistance*n.maxDistance&&n.object.position.addVectors(n.target,t.setLength(n.maxDistance)),t.lengthSq()<n.minDistance*n.minDistance&&n.object.position.addVectors(n.target,t.setLength(n.minDistance)))},this.update=function(){t.subVectors(n.object.position,n.target),n.noRotate||n.rotateCamera(),n.noZoom||n.zoomCamera(),n.noPan||n.panCamera(),n.object.position.addVectors(n.target,t),n.checkDistances(),n.object.lookAt(n.target),q.distanceToSquared(n.object.position)>p&&(n.dispatchEvent(C),q.copy(n.object.position))},this.reset=function(){r=o.NONE,s=o.NONE,n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.up.copy(n.up0),t.subVectors(n.object.position,n.target),n.object.lookAt(n.target),n.dispatchEvent(C),q.copy(n.object.position)},this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1),this.domElement.addEventListener("mousedown",g,!1),this.domElement.addEventListener("mousewheel",j,!1),this.domElement.addEventListener("DOMMouseScroll",j,!1),this.domElement.addEventListener("touchstart",k,!1),this.domElement.addEventListener("touchend",m,!1),this.domElement.addEventListener("touchmove",l,!1),a.addEventListener("keydown",e,!1),a.addEventListener("keyup",f,!1),this.handleResize(),this.update()},THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype);var i=["buffers","bufferViews","images","videos","samplers","textures","shaders","programs","techniques","materials","accessors","meshes","cameras","lights","skins","nodes","scenes","animations"],j=Object.create(Object.prototype,{_rootDescription:{value:null,writable:!0},rootDescription:{set:function(a){this._rootDescription=a},get:function(){return this._rootDescription}},baseURL:{value:null,writable:!0},_isAbsolutePath:{value:function(b){var c=new RegExp("^"+a.location.protocol,"i");return b.match(c)?!0:!1}},resolvePathIfNeeded:{value:function(a){return this._isAbsolutePath(a)?a:this.baseURL+a}},_resolvePathsForCategories:{value:function(a){a.forEach(function(a){var b=this.json[a];if(b){var c=Object.keys(b);c.forEach(function(a){var c=b[a];c.path=this.resolvePathIfNeeded(c.path)},this)}},this)}},_json:{value:null,writable:!0},json:{enumerable:!0,get:function(){return this._json},set:function(a){this._json!==a&&(this._json=a,this._resolvePathsForCategories(["buffers","shaders","images","videos"]))}},_path:{value:null,writable:!0},getEntryDescription:{value:function(a,b){var c=null,d=b;return c=this.rootDescription[d],c?c?c[a]:null:(console.log("ERROR:CANNOT find expected category named:"+d),null)}},_stepToNextCategory:{value:function(){return this._state.categoryIndex=this.getNextCategoryIndex(this._state.categoryIndex+1),-1!==this._state.categoryIndex?(this._state.categoryState.index=0,!0):!1}},_stepToNextDescription:{enumerable:!1,value:function(){var a=this._state.categoryState,b=a.keys;return b?(a.index++,a.keys=null,a.index>=b.length?this._stepToNextCategory():!1):(console.log("INCONSISTENCY ERROR"),!1)}},hasCategory:{value:function(a){return this.rootDescription[a]?!0:!1}},_handleState:{value:function(){for(var a={buffers:this.handleBuffer,bufferViews:this.handleBufferView,shaders:this.handleShader,programs:this.handleProgram,techniques:this.handleTechnique,materials:this.handleMaterial,meshes:this.handleMesh,cameras:this.handleCamera,lights:this.handleLight,nodes:this.handleNode,scenes:this.handleScene,images:this.handleImage,animations:this.handleAnimation,accessors:this.handleAccessor,skins:this.handleSkin,samplers:this.handleSampler,textures:this.handleTexture,videos:this.handleVideo},b=!0;-1!==this._state.categoryIndex;){var c=i[this._state.categoryIndex],d=this._state.categoryState,e=d.keys;if(e||(d.keys=e=Object.keys(this.rootDescription[c]),!e||0!==e.length)){var f=c,g=e[d.index],h=this.getEntryDescription(g,f);if(h){if(a[f]&&a[f].call(this,g,h,this._state.userInfo)===!1){b=!1;break}this._stepToNextDescription()}else if(this.handleError){this.handleError("INCONSISTENCY ERROR: no description found for entry "+g),b=!1;break}}else this._stepToNextDescription()}this.handleLoadCompleted&&this.handleLoadCompleted(b)}},_loadJSONIfNeeded:{enumerable:!0,value:function(a){var b=this;if(this._json)a&&a(this.json);else{var c=this._path,d=c.lastIndexOf("/");this.baseURL=0!==d?c.substring(0,d+1):"";var e=new XMLHttpRequest;e.open("GET",c,!0),e.addEventListener("load",function(){b.json=JSON.parse(e.responseText),a&&a(b.json)},!1),e.send(null)}}},_buildLoader:{value:function(a){function b(b){c.rootDescription=b,a&&a(this)}var c=this;this._loadJSONIfNeeded(b)}},_state:{value:null,writable:!0},_getEntryType:{value:function(){for(var a=i,b=0;b<a.length;b++){var c=this.rootDescription[a[b]];if(c)return a[b]}return null}},getNextCategoryIndex:{value:function(a){for(var b=a;b<i.length;b++)if(this.hasCategory(i[b]))return b;return-1}},load:{enumerable:!0,value:function(a,b){var c=this;this._buildLoader(function(){var d=c.getNextCategoryIndex.call(c,0);-1!==d&&(c._state={userInfo:a,options:b,categoryIndex:d,categoryState:{index:"0"}},c._handleState())})}},initWithPath:{value:function(a){return this._path=a,this._json=null,this}},_knownURLs:{writable:!0,value:{}},loaderContext:{value:function(){return"undefined"==typeof this._knownURLs[this._path]&&(this._knownURLs[this._path]=Object.keys(this._knownURLs).length),"__"+this._knownURLs[this._path]}},initWithJSON:{value:function(a,b){return this.json=a,this.baseURL=b,b||console.log("WARNING: no base URL passed to Reader:initWithJSON"),this}}});THREE.glTFAnimator=function(){var a=[];return{add:function(b){a.push(b)},remove:function(b){var c=a.indexOf(b);-1!==c&&a.splice(c,1)},update:function(){for(var b=0;b<a.length;b++)a[b].update()}}}(),THREE.glTFAnimation=function(a){this.running=!1,this.loop=!1,this.duration=0,this.startTime=0,this.interps=[],a&&this.createInterpolators(a)},THREE.glTFAnimation.prototype.createInterpolators=function(a){var b,c=a.length;for(b=0;c>b;b++){var d=new THREE.glTFInterpolator(a[b]);this.interps.push(d),this.duration=Math.max(this.duration,d.duration)}},THREE.glTFAnimation.prototype.play=function(){this.running||(this.startTime=Date.now(),this.running=!0,THREE.glTFAnimator.add(this))},THREE.glTFAnimation.prototype.stop=function(){this.running=!1,THREE.glTFAnimator.remove(this)},THREE.glTFAnimation.prototype.update=function(){if(this.running){var a=Date.now(),b=(a-this.startTime)/1e3,c=b%this.duration,d=Math.floor(b/this.duration);if(d>=1&&!this.loop){this.running=!1;var e,f=this.interps.length;for(e=0;f>e;e++)this.interps[e].interp(this.duration);return void this.stop()}var e,f=this.interps.length;for(e=0;f>e;e++)this.interps[e].interp(c)}},THREE.glTFInterpolator=function(a){this.keys=a.keys,this.values=a.values,this.count=a.count,this.type=a.type,this.path=a.path,this.isRot=!1;var b=a.target;switch(b.updateMatrix(),b.matrixAutoUpdate=!0,this.targetNode=b,a.path){case"translation":this.target=b.position,this.originalValue=b.position.clone();break;case"rotation":this.target=b.quaternion,this.originalValue=b.quaternion.clone(),this.isRot=!0;break;case"scale":this.target=b.scale,this.originalValue=b.scale.clone()}this.duration=this.keys[this.count-1],this.vec1=new THREE.Vector3,this.vec2=new THREE.Vector3,this.vec3=new THREE.Vector3,this.quat1=new THREE.Quaternion,this.quat2=new THREE.Quaternion,this.quat3=new THREE.Quaternion},THREE.glTFInterpolator.prototype.interp=function(a){var b;if(a===this.keys[0])this.isRot?this.quat3.set(this.values[0],this.values[1],this.values[2],this.values[3]):this.vec3.set(this.values[0],this.values[1],this.values[2]);else if(a<this.keys[0])this.isRot?(this.quat1.set(this.originalValue.x,this.originalValue.y,this.originalValue.z,this.originalValue.w),this.quat2.set(this.values[0],this.values[1],this.values[2],this.values[3]),THREE.Quaternion.slerp(this.quat1,this.quat2,this.quat3,a/this.keys[0])):(this.vec3.set(this.originalValue.x,this.originalValue.y,this.originalValue.z),this.vec2.set(this.values[0],this.values[1],this.values[2]),this.vec3.lerp(this.vec2,a/this.keys[0]));else if(a>=this.keys[this.count-1])this.isRot?this.quat3.set(this.values[4*(this.count-1)],this.values[4*(this.count-1)+1],this.values[4*(this.count-1)+2],this.values[4*(this.count-1)+3]):this.vec3.set(this.values[3*(this.count-1)],this.values[3*(this.count-1)+1],this.values[3*(this.count-1)+2]);else for(b=0;b<this.count-1;b++){var c=this.keys[b],d=this.keys[b+1];a>=c&&d>=a&&(this.isRot?(this.quat1.set(this.values[4*b],this.values[4*b+1],this.values[4*b+2],this.values[4*b+3]),this.quat2.set(this.values[4*(b+1)],this.values[4*(b+1)+1],this.values[4*(b+1)+2],this.values[4*(b+1)+3]),THREE.Quaternion.slerp(this.quat1,this.quat2,this.quat3,(a-c)/(d-c))):(this.vec3.set(this.values[3*b],this.values[3*b+1],this.values[3*b+2]),this.vec2.set(this.values[3*(b+1)],this.values[3*(b+1)+1],this.values[3*(b+1)+2]),this.vec3.lerp(this.vec2,(a-c)/(d-c))))}this.target&&this.copyValue(this.target)},THREE.glTFInterpolator.prototype.copyValue=function(a){a.copy(this.isRot?this.quat3:this.vec3)},THREE.glTFLoader=function(a){this.meshesRequested=0,this.meshesLoaded=0,this.pendingMeshes=[],this.animationsRequested=0,this.animationsLoaded=0,this.animations=[],this.shadersRequested=0,this.shadersLoaded=0,this.shaders={},THREE.Loader.call(this,a)},THREE.glTFLoader.prototype=Object.create(THREE.Loader.prototype),THREE.glTFLoader.prototype.constructor=THREE.glTFLoader,THREE.glTFLoader.prototype.load=function(c,d){function e(a){if(!a)return 4294967295;var b=Math.floor(255*a[0]),c=Math.floor(255*a[1]),d=Math.floor(255*a[2]),e=255,f=(e<<24)+(b<<16)+(c<<8)+d;return f}function f(a,b){{var c,d=new THREE.Quaternion,e=new THREE.Vector3;new THREE.Vector3}for(c=0;b>c;c++){e.set(a[4*c],a[4*c+1],a[4*c+2]).normalize();var f=a[4*c+3];d.setFromAxisAngle(e,f),a[4*c]=d.x,a[4*c+1]=d.y,a[4*c+2]=d.z,a[4*c+3]=d.w}}function g(a){switch(a){case WebGLRenderingContext.FLOAT:case WebGLRenderingContext.UNSIGNED_BYTE:case WebGLRenderingContext.UNSIGNED_SHORT:return 1;case WebGLRenderingContext.FLOAT_VEC2:return 2;case WebGLRenderingContext.FLOAT_VEC3:return 3;case WebGLRenderingContext.FLOAT_VEC4:return 4;case WebGLRenderingContext.FLOAT_MAT4:return 16;default:return null}}function h(a){return a?THREE.ImageUtils.loadTexture(a):null}var i=this,k=function(){this.geometry=new THREE.BufferGeometry,this.totalAttributes=0,this.loadedAttributes=0,this.indicesLoaded=!1,this.finished=!1,this.onload=null,this.uvs=null,this.indexArray=null};k.prototype.constructor=k,k.prototype.buildBufferGeometry=function(){var a=this.geometry;a.addAttribute("index",new THREE.BufferAttribute(this.indexArray,1)),a.addDrawCall(0,this.indexArray.length,0),a.computeBoundingSphere()},k.prototype.checkFinished=function(){this.indexArray&&this.loadedAttributes===this.totalAttributes&&(this.buildBufferGeometry(),this.finished=!0,this.onload&&this.onload())};var l=function(){};l.prototype.handleError=function(a,b){console.log("ERROR(IndicesDelegate):"+a+":"+b)},l.prototype.convert=function(a,b){return new Uint16Array(a,0,b.indices.count)},l.prototype.resourceAvailable=function(a,b){var c=b.geometry;return c.indexArray=a,c.checkFinished(),!0};var m=new l,n=function(a,b){this.indices=a,this.geometry=b},o=function(){};o.prototype.handleError=function(a,b){console.log("ERROR(VertexAttributeDelegate):"+a+":"+b)},o.prototype.convert=function(a){return a},o.prototype.arrayResourceAvailable=function(a,b){var c,d,e,f,h=b.geometry,i=b.attribute,j=b.semantic;if("POSITION"===j)for(c=new Float32Array(a,0,i.count*g(i.type)),d=0,e=c.length;e>d;d+=3)h.geometry.vertices.push(new THREE.Vector3(c[d],c[d+1],c[d+2]));else if("NORMAL"===j)for(h.geometry.normals=[],c=new Float32Array(a,0,i.count*g(i.type)),d=0,e=c.length;e>d;d+=3)h.geometry.normals.push(new THREE.Vector3(c[d],c[d+1],c[d+2]));else if("TEXCOORD_0"===j||"TEXCOORD"===j)for(h.uvs=[],c=new Float32Array(a,0,i.count*g(i.type)),d=0,e=c.length;e>d;d+=2)h.uvs.push(new THREE.Vector2(c[d],1-c[d+1]));else if("WEIGHT"===j)for(f=g(i.type),c=new Float32Array(a,0,i.count*f),d=0,e=c.length;e>d;d+=4)h.geometry.skinWeights.push(new THREE.Vector4(c[d],c[d+1],c[d+2],c[d+3]));else if("JOINT"===j)for(f=g(i.type),c=new Float32Array(a,0,i.count*f),d=0,e=c.length;e>d;d+=4)h.geometry.skinIndices.push(new THREE.Vector4(c[d],c[d+1],c[d+2],c[d+3]))},o.prototype.bufferResourceAvailable=function(a,b){var c,d,e,f=b.geometry,h=b.attribute,i=b.semantic;if("POSITION"===i)c=new Float32Array(a,0,h.count*g(h.type)),f.geometry.addAttribute("position",new THREE.BufferAttribute(c,3));else if("NORMAL"===i)c=new Float32Array(a,0,h.count*g(h.type)),f.geometry.addAttribute("normal",new THREE.BufferAttribute(c,3));else if("TEXCOORD_0"===i||"TEXCOORD"===i){for(e=g(h.type),c=new Float32Array(a,0,h.count*e),d=0;d<c.length/2;d++)c[2*d+1]=1-c[2*d+1];f.geometry.addAttribute("uv",new THREE.BufferAttribute(c,e))}else"WEIGHT"===i?(e=g(h.type),c=new Float32Array(a,0,h.count*e),f.geometry.addAttribute("skinWeight",new THREE.BufferAttribute(c,e))):"JOINT"===i&&(e=g(h.type),c=new Float32Array(a,0,h.count*e),f.geometry.addAttribute("skinIndex",new THREE.BufferAttribute(c,e)))},o.prototype.resourceAvailable=function(a,b){this.bufferResourceAvailable(a,b);var c=b.geometry;return c.loadedAttributes++,c.checkFinished(),!0};var p=new o,q=function(a,b,c){this.attribute=a,this.semantic=b,this.geometry=c},r=function(){this.primitives=[],this.materialsPending=[],this.loadedGeometry=0,this.onCompleteCallbacks=[]};r.prototype.addPrimitive=function(a,b){var c=this;a.onload=function(){c.loadedGeometry++,c.checkComplete()},this.primitives.push({geometry:a,material:b,mesh:null})},r.prototype.onComplete=function(a){this.onCompleteCallbacks.push(a),this.checkComplete()},r.prototype.checkComplete=function(){var a=this;this.onCompleteCallbacks.length&&this.primitives.length===this.loadedGeometry&&(this.onCompleteCallbacks.forEach(function(b){b(a)}),this.onCompleteCallbacks=[])},r.prototype.attachToNode=function(a){this.primitives.forEach(function(b){var c=b.material;c instanceof THREE.Material||(c=i.createShaderMaterial(c));var d=new THREE.Mesh(b.geometry.geometry,c);d.castShadow=!0,a.add(d)})};var s=function(a){this.params=a},t=function(){};t.prototype.handleError=function(a,b){console.log("ERROR(AnimationParameterDelegate):"+a+":"+b)},t.prototype.convert=function(a,b){var c=b.parameter,d=null;switch(c.type){case WebGLRenderingContext.FLOAT:case WebGLRenderingContext.FLOAT_VEC2:case WebGLRenderingContext.FLOAT_VEC3:case WebGLRenderingContext.FLOAT_VEC4:d=new Float32Array(a,0,c.count*g(c.type))}return d},t.prototype.resourceAvailable=function(a,b){var c=b.animation,d=b.parameter;return d.data=a,c.handleParameterLoaded(d),!0};var u=new t,v=function(a,b){this.parameter=a,this.animation=b},w=function(){this.totalParameters=0,this.loadedParameters=0,this.parameters={},this.finishedLoading=!1,this.onload=null};w.prototype.constructor=w,w.prototype.handleParameterLoaded=function(a){this.parameters[a.name]=a,this.loadedParameters++,this.checkFinished()},w.prototype.checkFinished=function(){this.loadedParameters===this.totalParameters&&(this.finishedLoading=!0,this.onload&&this.onload())};var x=function(){};x.prototype.handleError=function(a,b){console.log("ERROR(InverseBindMatricesDelegate):"+a+":"+b)},x.prototype.convert=function(a,b){var c=b.parameter,d=null;switch(c.type){case WebGLRenderingContext.FLOAT_MAT4:d=new Float32Array(a,0,c.count*g(c.type))}return d},x.prototype.resourceAvailable=function(a,b){var c=b.skin;return c.inverseBindMatrices=a,!0};var y=new x,z=function(a,b){this.parameter=a,this.skin=b},A=function(){};A.prototype.handleError=function(a,b){console.log("ERROR(ShaderDelegate):"+a+":"+b)},A.prototype.convert=function(a){return a},A.prototype.resourceAvailable=function(a,b){return i.shadersLoaded++,i.shaders[b.id]=a,!0};var B=new A,C=function(a,b){this.id=a,this.path=b},D=function(a,b,c){this.entryID=a,this.object=b,this.description=c},E=function(){this._entries={}};E.prototype.setEntry=function(a,b,c){return a?(this._entries[a]&&console.warn("entry["+a+"] is being overwritten"),void(this._entries[a]=new D(a,b,c))):void console.error("No EntryID provided, cannot store",c)},E.prototype.getEntry=function(a){return this._entries[a]},E.prototype.clearEntries=function(){this._entries={}};var F=function(){};F.prototype.loadCompleted=function(b,c){b.call(a,c)};var G=Object.create(j,{load:{enumerable:!0,value:function(a,b){this.resources=new E,this.cameras=[],this.lights=[],this.animations=[],this.joints={},this.skeltons={},THREE.GLTFLoaderUtils.init(),j.load.call(this,a,b)}},cameras:{enumerable:!0,writable:!0,value:[]},lights:{enumerable:!0,writable:!0,value:[]},animations:{enumerable:!0,writable:!0,value:[]},handleBuffer:{value:function(a,b){return this.resources.setEntry(a,null,b),b.type="ArrayBuffer",!0}},handleBufferView:{value:function(a,b){this.resources.setEntry(a,null,b);var c=this.resources.getEntry(b.buffer);b.type="ArrayBufferView";var d=this.resources.getEntry(a);return d.buffer=c,!0}},handleShader:{value:function(a,b){this.resources.setEntry(a,null,b);var c={id:a,path:b.path},d=new C(a,b.path);return i.shadersRequested++,THREE.GLTFLoaderUtils.getFile(c,B,d),!0}},handleProgram:{value:function(a,b){return this.resources.setEntry(a,null,b),!0}},handleTechnique:{value:function(a,b){return this.resources.setEntry(a,null,b),!0}},createShaderMaterial:{value:function(a){var b=i.shaders[a.params.fragmentShader];if(!b)return console.log("ERROR: Missing fragment shader definition:",a.params.fragmentShader),new THREE.MeshPhongMaterial;var c=i.shaders[a.params.vertexShader];if(!b)return console.log("ERROR: Missing vertex shader definition:",a.params.vertexShader),new THREE.MeshPhongMaterial;{var d={};new THREE.ShaderMaterial({fragmentShader:b,vertexShader:c,uniforms:d})}return new THREE.MeshPhongMaterial(a.params)}},createShaderParams:{value:function(a,b,c,d){var e=this.resources.getEntry(d.program);e&&(c.fragmentShader=e.description.fragmentShader,c.vertexShader=e.description.vertexShader,c.attributes=d.attributes,c.uniforms=d.uniforms)}},threeJSMaterialType:{value:function(a,c,d,f){var g=THREE.MeshPhongMaterial,i=null;if(c&&c.description&&c.description.passes&&(i=c.description.passes.defaultPass),i)if(i.details&&i.details.commonProfile){var j=c.description.passes.defaultPass.details.commonProfile;if(j){switch(j.lightingModel){case"Blinn":case"Phong":g=THREE.MeshPhongMaterial;break;case"Lambert":g=THREE.MeshLambertMaterial;break;default:g=THREE.MeshBasicMaterial}j.extras&&j.extras.doubleSided&&(f.side=THREE.DoubleSide)}}else if(i.instanceProgram){var k=i.instanceProgram;this.createShaderParams(a,d,f,k);var l=!0;l&&(g=s)}var m=null,n=null,o=d.diffuse;if(o){var p=o;if(p){var q=this.resources.getEntry(p);if(q){var r=this.resources.getEntry(q.description.source);r&&(m=r.description.path);var t=this.resources.getEntry(q.description.sampler);t&&(n=t.description)}}}var p=h(m);p&&n&&(n.wrapS===WebGLRenderingContext.REPEAT&&(p.wrapS=THREE.RepeatWrapping),n.wrapT===WebGLRenderingContext.REPEAT&&(p.wrapT=THREE.RepeatWrapping),n.magFilter===WebGLRenderingContext.LINEAR&&(p.magFilter=THREE.LinearFilter),f.map=p);var u=null,v=null,w=d.reflective;if(w){var p=w;if(p){var q=this.resources.getEntry(p);if(q){var r=this.resources.getEntry(q.description.source);r&&(u=r.description.path);var t=this.resources.getEntry(q.description.sampler);t&&(v=t.description)}}}var p=h(u);p&&v&&(v.wrapS===WebGLRenderingContext.REPEAT&&(p.wrapS=THREE.RepeatWrapping),v.wrapT===WebGLRenderingContext.REPEAT&&(p.wrapT=THREE.RepeatWrapping),v.magFilter===WebGLRenderingContext.LINEAR&&(p.magFilter=THREE.LinearFilter),f.envMap=p);var x=d.shininesss||d.shininess;x&&(x=x);var y=m?null:o,z=1;if(d.hasOwnProperty("transparency")){var A=!0;z=A?d.transparency:1-d.transparency}return f.color=e(y),f.opacity=z,f.transparent=1>z,m&&-1!==m.toLowerCase().indexOf(".png")&&(f.transparent=!0),x!==b&&(f.shininess=x),d.ambient!==b&&"string"!=typeof d.ambient&&(f.ambient=e(d.ambient)),d.emission!==b&&(f.emissive=e(d.emission)),d.specular!==b&&(f.specular=e(d.specular)),g}},handleMaterial:{value:function(a,b){var c=this.resources.getEntry(b.instanceTechnique.technique),d={},e=b.instanceTechnique.values,f=this.threeJSMaterialType(a,c,e,d),g=new f(d);return this.resources.setEntry(a,g,b),!0}},handleMesh:{value:function(a,b){var c=new r;this.resources.setEntry(a,c,b);var d=b.primitives;if(!d)return console.log("MISSING_PRIMITIVES for mesh:"+a),!1;for(var e=0;e<d.length;e++){var f=d[e];if(f.primitive===WebGLRenderingContext.TRIANGLES){var g=new k,h=this.resources.getEntry(f.material);c.addPrimitive(g,h.object);var i=this.resources.getEntry(f.indices),j=this.resources.getEntry(i.description.bufferView),l={bufferView:j,byteOffset:i.description.byteOffset,count:i.description.count,id:i.entryID,type:i.description.type},o=new n(l,g),s=(THREE.GLTFLoaderUtils.getBuffer(l,m,o),Object.keys(f.attributes));s.forEach(function(a){g.totalAttributes++;var c,d,e=f.attributes[a],h=this.resources.getEntry(e);h?(c=h.object,c.id=e,d=this.resources.getEntry(c.bufferView)):(c=b.attributes[e],c.id=e,this.resources.setEntry(e,c,c),d=this.resources.getEntry(c.bufferView),h=this.resources.getEntry(e));{var i={bufferView:d,byteOffset:c.byteOffset,byteStride:c.byteStride,count:c.count,max:c.max,min:c.min,type:c.type,id:e},j=new q(i,a,g);THREE.GLTFLoaderUtils.getBuffer(i,p,j)}},this)}}return!0}},handleCamera:{value:function(c,d){var e,f,g;if("perspective"===d.type){f=d.perspective.znear,g=d.perspective.zfar;var h=d.perspective.yfov,i=d.perspective.xfov,j=d.perspective.aspect_ratio;j||(j=1),h===b&&i&&(h=i/j),h&&(e=new THREE.PerspectiveCamera(h,j,f,g))}else e=new THREE.OrthographicCamera(a.innerWidth/-2,a.innerWidth/2,a.innerHeight/2,a.innerHeight/-2,f,g);return e&&this.resources.setEntry(c,e,d),!0}},handleLight:{value:function(a,b){var c=null,d=b.type;if(d&&b[d]){var f=b[d],g=e(f.color);switch(d){case"directional":c=new THREE.DirectionalLight(g),c.position.set(0,0,1);break;case"point":c=new THREE.PointLight(g);break;case"spot ":c=new THREE.SpotLight(g),c.position.set(0,0,1);
break;case"ambient":c=new THREE.AmbientLight(g)}}return c&&this.resources.setEntry(a,c,b),!0}},addPendingMesh:{value:function(a,b){i.pendingMeshes.push({mesh:a,node:b})}},handleNode:{value:function(a,b){var c=null;b.jointId?(c=new THREE.Bone,c.jointId=b.jointId,this.joints[b.jointId]=a):c=new THREE.Object3D,c.name=b.name,this.resources.setEntry(a,c,b);var d=b.matrix;if(d)c.applyMatrix((new THREE.Matrix4).fromArray(d)),c.matrixAutoUpdate=!1,c.matrixWorldNeedsUpdate=!0;else{var e=b.translation,g=b.rotation,h=b.scale,j=e?new THREE.Vector3(e[0],e[1],e[2]):new THREE.Vector3;g&&f(g,1);var k=g?new THREE.Quaternion(g[0],g[1],g[2],g[3]):new THREE.Quaternion,l=h?new THREE.Vector3(h[0],h[1],h[2]):new THREE.Vector3,m=new THREE.Matrix4;m.compose(j,k,l),c.matrixAutoUpdate=!1,c.matrixWorldNeedsUpdate=!0,c.applyMatrix(m)}var n,o=this;if(b.mesh&&(n=this.resources.getEntry(b.mesh),i.meshesRequested++,n.object.onComplete(function(a){o.addPendingMesh(a,c),i.meshesLoaded++,i.checkComplete()})),b.meshes&&b.meshes.forEach(function(a){n=this.resources.getEntry(a),i.meshesRequested++,n.object.onComplete(function(a){o.addPendingMesh(a,c),i.meshesLoaded++,i.checkComplete()})},this),b.instanceSkin){var p=this.resources.getEntry(b.instanceSkin.skin);if(p){var q=p.object;b.instanceSkin.skin=q,c.instanceSkin=b.instanceSkin;var r=b.instanceSkin.sources;q.meshes=[],r.forEach(function(a){n=this.resources.getEntry(a),i.meshesRequested++,n.object.onComplete(function(a){q.meshes.push(a),i.meshesLoaded++,i.checkComplete()})},this)}}if(b.camera){var s=this.resources.getEntry(b.camera);s&&(c.add(s.object),this.cameras.push(s.object))}if(b.light){var t=this.resources.getEntry(b.light);t&&(c.add(t.object),this.lights.push(t.object))}return!0}},buildNodeHirerachy:{value:function(a,b){var c=this.resources.getEntry(a),d=c.object;b.add(d);var e=c.description.children;return e&&e.forEach(function(a){this.buildNodeHirerachy(a,d)},this),d}},buildSkin:{value:function(a){var b=a.instanceSkin.skin;b&&a.instanceSkin.skeletons.forEach(function(c){var d=this.resources.getEntry(c);if(d){var e,f=d.object,g=!0,h=b.meshes.length;for(e=0;h>e;e++){var i=b.meshes[e],j=null;i.primitives.forEach(function(d){var e=d.material;e instanceof THREE.Material||(e=this.createShaderMaterial(e)),j=new THREE.SkinnedMesh(d.geometry.geometry,e,!1),j.add(f);var h,i=d.geometry.geometry;if(i.vertices)for(h=0;h<i.vertices.length;h++)i.vertices[h].applyMatrix4(b.bindShapeMatrix);else if(i.attributes.position){var k=i.attributes.position.array,l=new THREE.Vector3;for(h=0;h<k.length/3;h++)l.set(k[3*h],k[3*h+1],k[3*h+2]),l.applyMatrix4(b.bindShapeMatrix),k[3*h]=l.x,k[3*h+1]=l.y,k[3*h+2]=l.z}if(j&&g){e.skinning=!0,j.boneInverses=[];var m,n=b.jointsIds,o=[],p=[],q=n.length;for(m=0;q>m;m++){var r=n[m],s=this.joints[r],t=this.resources.getEntry(s).object;if(t){t.skin=j,o.push(t);var u=b.inverseBindMatrices,v=(new THREE.Matrix4).set(u[16*m+0],u[16*m+4],u[16*m+8],u[16*m+12],u[16*m+1],u[16*m+5],u[16*m+9],u[16*m+13],u[16*m+2],u[16*m+6],u[16*m+10],u[16*m+14],u[16*m+3],u[16*m+7],u[16*m+11],u[16*m+15]);p.push(v)}else console.log("WARNING: jointId:"+r+" cannot be found in skeleton:"+c)}j.bind(new THREE.Skeleton(o,p,!1))}j&&(j.castShadow=!0,a.add(j))},this)}}},this)}},buildSkins:{value:function(a){a.instanceSkin&&this.buildSkin(a);var b=a.children;b&&b.forEach(function(a){this.buildSkins(a)},this)}},createMeshAnimations:{value:function(a){this.buildSkins(a)}},handleScene:{value:function(a,b,c){return b.nodes?(b.nodes.forEach(function(a){this.buildNodeHirerachy(a,c.rootObj)},this),this.delegate&&this.delegate.loadCompleted(c.callback,c.rootObj),!0):(console.log("ERROR: invalid file required nodes property is missing from scene"),!1)}},handleImage:{value:function(a,b){return this.resources.setEntry(a,null,b),!0}},addNodeAnimationChannel:{value:function(a,b,c){this.nodeAnimationChannels||(this.nodeAnimationChannels={}),this.nodeAnimationChannels[a]||(this.nodeAnimationChannels[a]=[]),this.nodeAnimationChannels[a].push(c)}},createAnimations:{value:function(){for(var a in this.nodeAnimationChannels){var b=this.nodeAnimationChannels[a],c=(b.length,new THREE.glTFAnimation(b));c.name="animation_"+a,this.animations.push(c)}}},buildAnimation:{value:function(a){var b,c=[],d=a.channels.length;for(b=0;d>b;b++){var e=a.channels[b],g=a.samplers[e.sampler];if(g){var h=a.parameters[g.input];if(h&&h.data){var i=a.parameters[g.output];if(i&&i.data){var j=e.target,k=this.resources.getEntry(j.id);if(k){var l=j.path;"rotation"===l&&f(i.data,i.count);var m={keys:h.data,values:i.data,count:h.count,target:k.object,path:l,type:g.interpolation};this.addNodeAnimationChannel(j.id,e,m),c.push(m)}}}}}}},handleAnimation:{value:function(a,b){i.animationsRequested++;var c=new w;c.name=a,c.onload=function(){i.animationsLoaded++,i.animations.push(c),i.checkComplete()},c.channels=b.channels,c.samplers=b.samplers,this.resources.setEntry(a,c,b);var d=b.parameters;if(!d)return console.log("MISSING_PARAMETERS for animation:"+a),!1;var e=Object.keys(d);return e.forEach(function(a){c.totalParameters++;var b=d[a],e=this.resources.getEntry(b);e=e.object;{var f=this.resources.getEntry(e.bufferView),g={bufferView:f,byteOffset:e.byteOffset,count:e.count,type:e.type,id:e.bufferView,name:a},h=new v(g,c);THREE.GLTFLoaderUtils.getBuffer(g,u,h)}},this),!0}},handleAccessor:{value:function(a,b){return this.resources.setEntry(a,b,b),!0}},handleSkin:{value:function(a,b){var c={},d=b.bindShapeMatrix;c.bindShapeMatrix=(new THREE.Matrix4).fromArray(d),c.jointsIds=b.joints;var e=b.inverseBindMatrices;c.inverseBindMatricesDescription=e,c.inverseBindMatricesDescription.id=a+"_inverseBindMatrices";var f=this.resources.getEntry(e.bufferView),g={bufferView:f,byteOffset:e.byteOffset,count:e.count,type:e.type,id:e.bufferView,name:c.inverseBindMatricesDescription.id},h=new z(g,c),i=(THREE.GLTFLoaderUtils.getBuffer(g,y,h),this.resources.getEntry(c.inverseBindMatricesDescription.bufferView));return c.inverseBindMatricesDescription.bufferView=i.object,this.resources.setEntry(a,c,b),!0}},handleSampler:{value:function(a,b){return this.resources.setEntry(a,b,b),!0}},handleTexture:{value:function(a,b){return this.resources.setEntry(a,null,b),!0}},handleError:{value:function(a){throw new Error(a)}},_delegate:{value:new F,writable:!0},delegate:{enumerable:!0,get:function(){return this._delegate},set:function(a){this._delegate=a}}}),H=function(a,b){this.rootObj=a,this.callback=b},I=new THREE.Object3D,J=Object.create(G);return J.initWithPath(c),J.load(new H(I,function(){}),null),this.loader=J,this.callback=d,this.rootObj=I,I},THREE.glTFLoader.prototype.callLoadedCallback=function(){var a={scene:this.rootObj,cameras:this.loader.cameras,animations:this.loader.animations};this.callback(a)},THREE.glTFLoader.prototype.checkComplete=function(){if(this.meshesLoaded===this.meshesRequested&&this.shadersLoaded===this.shadersRequested&&this.animationsLoaded===this.animationsRequested){for(var a=0;a<this.pendingMeshes.length;a++){var b=this.pendingMeshes[a];b.mesh.attachToNode(b.node)}for(var a=0;a<this.animationsLoaded;a++){var c=this.animations[a];this.loader.buildAnimation(c)}this.loader.createAnimations(),this.loader.createMeshAnimations(this.rootObj),this.callLoadedCallback()}},THREE.GLTFLoaderUtils=Object.create(Object,{MISSING_DESCRIPTION:{value:"MISSING_DESCRIPTION"},INVALID_PATH:{value:"INVALID_PATH"},INVALID_TYPE:{value:"INVALID_TYPE"},XMLHTTPREQUEST_STATUS_ERROR:{value:"XMLHTTPREQUEST_STATUS_ERROR"},NOT_FOUND:{value:"NOT_FOUND"},ARRAY_BUFFER:{value:"ArrayBuffer"},_streams:{value:{},writable:!0},_streamsStatus:{value:{},writable:!0},_resources:{value:{},writable:!0},_resourcesStatus:{value:{},writable:!0},init:{value:function(){this._streams={},this._streamsStatus={},this._resources={},this._resourcesStatus={}}},_containsResource:{enumerable:!1,value:function(a){return this._resources[a]?!0:!1}},_storeResource:{enumerable:!1,value:function(a,b){return a?(this._containsResource[a]&&console.log("WARNING: resource:"+a+" is already stored, overriding"),void(this._resources[a]=b)):void console.log("ERROR: entry does not contain id, cannot store")}},_getResource:{enumerable:!1,value:function(a){return this._resources[a]}},_loadStream:{value:function(a,b,c){if(!b)return void c.handleError(THREE.GLTFLoaderUtils.INVALID_TYPE,null);if(!a)return void c.handleError(THREE.GLTFLoaderUtils.INVALID_PATH);var d=new XMLHttpRequest;d.open("GET",a,!0),d.responseType=b===this.ARRAY_BUFFER?"arraybuffer":"text",d.setRequestHeader("If-Modified-Since","Sat, 01 Jan 1970 00:00:00 GMT"),d.addEventListener("load",function(){c.streamAvailable(a,d.response)},!1),d.addEventListener("error",function(){c.handleError(THREE.GLTFLoaderUtils.XMLHTTPREQUEST_STATUS_ERROR,d.status)},!1),d.send(null)}},send:{value:0,writable:!0},requested:{value:0,writable:!0},_handleRequest:{value:function(a){var b=this._resourcesStatus[a.id];b?this._resourcesStatus[a.id]++:this._resourcesStatus[a.id]=1;var c=this._streamsStatus[a.path];if(c&&"loading"===c.status)return void c.requests.push(a);this._streamsStatus[a.path]={status:"loading",requests:[a]};var d=this,e={};e.streamAvailable=function(a,b){var c=d._streamsStatus[a],e=c.requests;e.forEach(function(a){var c=b.slice(a.range[0],a.range[1]),e=a.delegate.convert(c,a.ctx);d._storeResource(a.id,e),a.delegate.resourceAvailable(e,a.ctx),--d._resourcesStatus[a.id]},this),delete d._streamsStatus[a]},e.handleError=function(b,c){a.delegate.handleError(b,c)},this._loadStream(a.path,a.type,e)}},_elementSizeForGLType:{value:function(a){switch(a){case WebGLRenderingContext.FLOAT:return Float32Array.BYTES_PER_ELEMENT;case WebGLRenderingContext.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case WebGLRenderingContext.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case WebGLRenderingContext.FLOAT_VEC2:return 2*Float32Array.BYTES_PER_ELEMENT;case WebGLRenderingContext.FLOAT_VEC3:return 3*Float32Array.BYTES_PER_ELEMENT;case WebGLRenderingContext.FLOAT_VEC4:return 4*Float32Array.BYTES_PER_ELEMENT;case WebGLRenderingContext.FLOAT_MAT3:return 9*Float32Array.BYTES_PER_ELEMENT;case WebGLRenderingContext.FLOAT_MAT4:return 16*Float32Array.BYTES_PER_ELEMENT;default:return null}}},_handleWrappedBufferViewResourceLoading:{value:function(a,b,c){var d=a.bufferView,e=d.buffer,f=a.byteOffset+d.description.byteOffset,g=[f,this._elementSizeForGLType(a.type)*a.count+f];this._handleRequest({id:a.id,range:g,type:e.description.type,path:e.description.path,delegate:b,ctx:c},null)}},getBuffer:{value:function(a,b,c){var d=this._getResource(a.id);return d?d:(this._handleWrappedBufferViewResourceLoading(a,b,c),null)}},getFile:{value:function(a,b,c){return a.delegate=b,a.ctx=c,this._handleRequest({id:a.id,path:a.path,range:[0],type:"text",delegate:b,ctx:c},null),null}}})}(window);</script>